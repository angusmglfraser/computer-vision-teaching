<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Sobel Edge Detection</title>
</head>
<body>
	<script src="global.js"></script>	
	<h1>Sobel Edge Detection</h1>
	<table>
		<tr>
			<td>1</td>
			<td>2</td>
			<td>1</td>
		</tr>
		<tr>
			<td>0</td>
			<td>0</td>
			<td>0</td>
		</tr>
		<tr>
			<td>-1</td>
			<td>-2</td>
			<td>-1</td>
		</tr>
	</table>
	<p>
		The Sobel operator is a kernel used for edge detection. The kernel can, however, only detect a gradient in intensity along one direction,
		so with this kernel, a perfectly vertical edge would not register, and as an edge moves from being horizontal to vertical, it becomes
		less intense in the output of the convolution. Below you can see the result of convolving an image with this matrix, then with the same
		matrix rotated 90 degrees, and then with a combined value for the two. Try taking an object with a straight edge and rotate it. See how the 
		edge changes in intensity in the first two images as it is being rotated, but changes little in the image that combines the two. 
	</p>
	
	
	<button id="startBtn" onClick="animating = true;computeFrame();">Start Edge Detection</button>
	<button id="stopBtn">Stop Edge Detection</button>
	<input type="checkbox" id="gaussianToggle" />Gaussian Blur
	<br />

	<canvas id="camfeed"></canvas>
	<canvas id="sobelx"></canvas>
	<canvas id="sobely"></canvas>
	<canvas id="sobelboth"></canvas>

	<canvas id="zoomwindow"></canvas>
	

	<video id="webcam" autoplay style="display: none"></video>
	<script type="text/javascript">

	var blur = false;
	var animating = false;

	const sobelKernel = [
		[1,0,-1],
		[2,0,-2],
		[1,0,-1]
	];
	const sobelRotated = [
		[1,2,1],
		[0,0,0],
		[-1,-2,-1]
	];

	

	function computeFrame() {
		var videoElement = document.getElementById('webcam');
		var camfeedctx = document.getElementById('camfeed').getContext('2d');
		camfeedctx.drawImage(
			videoElement,
			0,
			0,
			videoElement.videoWidth * 0.75,
			videoElement.videoHeight * 0.75
		);

		var inputImage = camfeedctx.getImageData(0,0,videoElement.videoWidth * 0.75, videoElement.videoHeight * 0.75);

		if (blur) {
			inputImage = convolve(inputImage,gaussKernel,5,5);
		}
		inputImage = greyScale(inputImage);
		var x = convolve(inputImage, sobelKernel, 3, 3);
		var y = convolve(inputImage, sobelRotated, 3, 3);
		var both = combineConvolutions(x,y);

		document.getElementById('sobelx').getContext('2d').putImageData(x, 0, 0);
		document.getElementById('sobely').getContext('2d').putImageData(y, 0, 0);
		document.getElementById('sobelboth').getContext('2d').putImageData(both, 0, 0);

		if (animating) {
			requestAnimationFrame(computeFrame);
		}
	}


	document.getElementById('stopBtn').addEventListener('click', function (event) {
		animating = false;
	});

	document.getElementById('gaussianToggle').addEventListener('change', function(event) {
		if (this.checked) {
			blur = true;
		} else {
			blur = false;
		}
	});
	initCamera();
	</script>
</html>